#!/bin/sh

echo "Moving config files."
# allow to load nvidia module
mv /etc/modprobe.d/disable-nvidia.conf /etc/modprobe.d/disable-nvidia.conf.disable
# add ICD layer for vulkan
mv /home/ericonr/.local/share/vulkan/icd.d/nvidiaegl_icd.json.disable /home/ericonr/.local/share/vulkan/icd.d/nvidiaegl_icd.json

echo "Changing power settings."
# Remove NVIDIA card (currently in power/control = auto)
echo -n 1 > /sys/bus/pci/devices/0000\:01\:00.0/remove
sleep 1
# change PCIe power control
echo -n on > /sys/bus/pci/devices/0000\:00\:01.0/power/control
sleep 1
# rescan for NVIDIA card (defaults to power/control = on)
echo -n 1 > /sys/bus/pci/rescan

echo "Loading modules."
# someone said that modprobe nvidia is needed also to load nvidia, to check
modprobe nvidia
