#!/bin/sh

echo "Restarting bumblebee service."
systemctl restart bumblebeed.service
sleep 1

echo "Removing modules."
modprobe -r nvidia_drm
modprobe -r nvidia_uvm
modprobe -r nvidia_modeset
modprobe -r nvidia

echo "Changing power settings."
# Change NVIDIA card power control
echo -n auto > /sys/bus/pci/devices/0000\:01\:00.0/power/control
sleep 1
# change PCIe power control
echo -n auto > /sys/bus/pci/devices/0000\:00\:01.0/power/control
sleep 1

echo "Moving config files."
# Lock system form loading nvidia module
mv /etc/modprobe.d/disable-nvidia.conf.disable /etc/modprobe.d/disable-nvidia.conf
mv /home/ericonr/.local/share/vulkan/icd.d/nvidiaegl_icd.json /home/ericonr/.local/share/vulkan/icd.d/nvidiaegl_icd.json.disable
